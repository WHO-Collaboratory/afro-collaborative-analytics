{
  "hash": "7d90b2db1e580d257c6cf1d74685f3c3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Task 2: Generating automated situation reports\"\n---\n\n\n\n\n## Overview\n\nThis task covers generating automated situation reports with dynamic figures and tables. You will learn how to create reproducible reports that can be easily updated as new data becomes available.\n\n## Learning Objectives\n\n- Create automated report generation workflows\n- Incorporate dynamic figures and tables\n- Use Quarto for report generation\n- Build a basic epidemiological report with incidence curves and summary statistics\n\n## Step-by-Step Instructions: Creating a Basic Epidemiological Report in Quarto\n\nThis tutorial will guide you through creating a basic epidemiological report using Quarto. You'll generate an HTML report with an incidence curve, case fatality ratio (CFR), and an interactive summary table.\n\n### Step 1: Set Up Your Project Folder Structure\n\nBefore starting, it's important to organize your files properly. Let's create a clear folder structure:\n\n1. **Create a project folder** on your computer called `situation_report`.\n\n2. **Within that folder, create the following subfolders**:\n   - `data/` - for storing your datasets\n   - `scripts/` - for storing R scripts (optional)\n   - `outputs/` - for storing generated reports and figures\n\n### Step 2: Download the Linelist Dataset\n\n1. Navigate to the [Data](data.qmd) page on this website.\n2. Click the download button for **linelist.csv**.\n3. **Save the file to your `data/` folder** that you created in Step 1.\n4. The file path should be: `data/linelist.csv` (relative to where your Quarto document is saved).\n\n### Step 3: Create a New Quarto Document\n\n1. Open RStudio.\n2. Go to **File → New File → Quarto Document**.\n3. Choose **HTML** as the output format.\n4. Give your document a title (e.g., \"Epidemiological Situation Report\").\n5. Click **Create**.\n6. **Save the document in your project folder** (e.g., `situation_report.qmd`).\n\n### Step 4: Set Up the YAML Header\n\nAt the top of your Quarto document, ensure your YAML header looks like this:\n\n```yaml\n---\ntitle: \"Epidemiological Situation Report\"\nformat: html\neditor: visual\n---\n```\n\n### Step 5: Install and Load Required Packages\n\nIn the first code chunk of your document, install and load the required packages:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install pacman if needed\nif (!require(\"pacman\")) install.packages(\"pacman\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: pacman\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load required packages\npacman::p_load(\n  rio,        # For importing data\n  tidyverse,  # For data manipulation and visualization\n  DT,         # For interactive tables\n  lubridate   # For date handling\n)\n```\n:::\n\n\n\n\n### Step 6: Import the Data\n\nCreate a new code chunk to import the linelist data. Since you've saved it in the `data/` folder, we use a relative path:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Import the linelist data from your local data folder\nlinelist <- rio::import(\"data/linelist.csv\")\n\n# View the first few rows\nhead(linelist)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-9a4d1d4e58cc60e6b593\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-9a4d1d4e58cc60e6b593\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\"],[\"d1fafd\",\"53371b\",\"f5c3d8\",\"e66fa4\",\"49731d\",\"0f58c4\"],[0,1,1,2,0,2],[null,\"2014-04-09\",\"2014-04-18\",null,\"2014-03-19\",\"2014-04-22\"],[\"2014-04-07\",\"2014-04-15\",\"2014-04-21\",\"2014-04-21\",\"2014-04-25\",\"2014-04-26\"],[\"2014-04-17\",\"2014-04-20\",\"2014-04-25\",\"2014-05-06\",\"2014-05-02\",\"2014-04-29\"],[\"2014-04-19\",null,\"2014-04-30\",\"2014-05-12\",\"2014-05-07\",\"2014-05-17\"],[null,null,\"Recover\",\"Recover\",null,\"Recover\"],[\"f\",\"m\",\"f\",\"m\",\"f\",\"f\"],[\"Military Hospital\",\"Connaught Hospital\",\"other\",\"other\",null,\"other\"],[\"-13,2179906460980\",\"-13,2149052395664\",\"-13,2280410276091\",\"-13,2612684289806\",\"-13,2344265094994\",\"-13,2101641430217\"],[\"8,47351400551599\",\"8,46492652251777\",\"8,48335550908327\",\"8,46466205027363\",\"8,46857239958425\",\"8,45214268335056\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>case_id<\\/th>\\n      <th>generation<\\/th>\\n      <th>date_of_infection<\\/th>\\n      <th>date_of_onset<\\/th>\\n      <th>date_of_hospitalisation<\\/th>\\n      <th>date_of_outcome<\\/th>\\n      <th>outcome<\\/th>\\n      <th>gender<\\/th>\\n      <th>hospital<\\/th>\\n      <th>lon<\\/th>\\n      <th>lat<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":-1,\"scrollX\":true,\"dom\":\"rt\",\"searching\":false,\"paging\":false,\"info\":false,\"ordering\":false,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":2},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"case_id\",\"targets\":1},{\"name\":\"generation\",\"targets\":2},{\"name\":\"date_of_infection\",\"targets\":3},{\"name\":\"date_of_onset\",\"targets\":4},{\"name\":\"date_of_hospitalisation\",\"targets\":5},{\"name\":\"date_of_outcome\",\"targets\":6},{\"name\":\"outcome\",\"targets\":7},{\"name\":\"gender\",\"targets\":8},{\"name\":\"hospital\",\"targets\":9},{\"name\":\"lon\",\"targets\":10},{\"name\":\"lat\",\"targets\":11}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[-1,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n### Step 7: Clean and Prepare the Data\n\nBefore creating visualizations, we need to ensure the date column is in the correct format:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert date_of_onset to date format\nlinelist <- linelist |>\n  mutate(date_of_onset = as.Date(date_of_onset))\n```\n:::\n\n\n\n\n### Step 8: Create an Incidence Curve\n\nCreate a new section in your document and add a code chunk to create an incidence curve (epidemic curve) using `date_of_onset`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create incidence curve\nincidence_curve <- linelist |>\n  ggplot(aes(x = date_of_onset)) +\n  geom_histogram(binwidth = 7, fill = \"steelblue\", color = \"white\") +\n  labs(\n    title = \"Incidence Curve by Date of Onset\",\n    x = \"Date of Onset\",\n    y = \"Number of Cases\"\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(face = \"bold\", size = 14))\n\n# Display the plot\nprint(incidence_curve)\n```\n\n::: {.cell-output-display}\n![Incidence Curve by Date of Onset](task2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n### Step 9: Calculate Case Fatality Ratio (CFR)\n\nCreate a new section and calculate the CFR, making sure to exclude NA outcomes:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate CFR (excluding NA outcomes)\ncfr_data <- linelist |>\n  filter(!is.na(outcome)) |>\n  summarise(\n    total_cases = n(),\n    deaths = sum(outcome == \"Death\", na.rm = TRUE),\n    recovered = sum(outcome == \"Recover\", na.rm = TRUE),\n    cfr = round((deaths / total_cases) * 100, 2)\n  )\n```\n:::\n\n\n\n\nThe estimated Case Fatality Ratio is 52.42%.\n\n### Step 10: Create an Interactive Summary Table by Hospital\n\nCreate a new section and generate an interactive summary table grouped by hospital using `DT::datatable()`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create summary table by hospital\n# Group NA and \"other\" together\nhospital_summary <- linelist |>\n  mutate(\n    hospital_grouped = case_when(\n      is.na(hospital) | hospital == \"other\" ~ \"Other/Unknown\",\n      TRUE ~ hospital\n    )\n  ) |>\n  group_by(hospital_grouped) |>\n  summarise(\n    total_cases = n(),\n    deaths = sum(outcome == \"Death\", na.rm = TRUE),\n    recovered = sum(outcome == \"Recover\", na.rm = TRUE),\n    .groups = \"drop\"\n  ) |>\n  rename(hospital = hospital_grouped) |>\n  mutate(\n    cfr = round((deaths / (deaths + recovered)) * 100, 2),\n    cfr = ifelse(is.na(cfr), 0, cfr)\n  )\n\n# Create interactive table\nDT::datatable(\n  hospital_summary,\n  options = list(\n    pageLength = -1,\n    scrollX = TRUE,\n    dom = 'rt',\n    searching = FALSE,\n    paging = FALSE,\n    info = FALSE,\n    ordering = FALSE\n  ),\n  caption = \"Summary Statistics by Hospital\",\n  colnames = c(\n    \"Hospital\" = \"hospital\",\n    \"Total Cases\" = \"total_cases\",\n    \"Deaths\" = \"deaths\",\n    \"Recovered\" = \"recovered\",\n    \"CFR (%)\" = \"cfr\"\n  )\n)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-448eb30b0314c173e08b\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-448eb30b0314c173e08b\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"caption\":\"<caption>Summary Statistics by Hospital<\\/caption>\",\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\"],[\"Connaught Hospital\",\"Military Hospital\",\"Other/Unknown\",\"Princess Christian Maternity Hospital (PCMH)\",\"Rokupa Hospital\"],[44,25,76,12,9],[16,10,29,6,4],[16,7,29,4,3],[50,58.82,50,60,57.14]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Hospital<\\/th>\\n      <th>Total Cases<\\/th>\\n      <th>Deaths<\\/th>\\n      <th>Recovered<\\/th>\\n      <th>CFR (%)<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":-1,\"scrollX\":true,\"dom\":\"rt\",\"searching\":false,\"paging\":false,\"info\":false,\"ordering\":false,\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"hospital\",\"targets\":1},{\"name\":\"total_cases\",\"targets\":2},{\"name\":\"deaths\",\"targets\":3},{\"name\":\"recovered\",\"targets\":4},{\"name\":\"cfr\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"lengthMenu\":[-1,10,25,50,100]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\n\n### Step 11: Render Your Report\n\n1. Click the **Render** button in RStudio (or press `Ctrl+Shift+K` / `Cmd+Shift+K`).\n2. Quarto will process your document and generate an HTML file.\n3. The HTML report will open automatically in your browser.\n\n**Note:** The rendered HTML file will be saved in the same folder as your Quarto document, or you can specify a different output location in your YAML header.\n\n## Additional Resources\n\n::: {.panel-tabset}\n\n### Quarto Documentation\n- [Quarto Documentation](https://quarto.org/)\n- [Quarto for R](https://quarto.org/docs/get-started/hello/rstudio.html)\n\n### R Handbook\n- [Epidemiologist R Handbook - Reports](https://www.epirhandbook.com/en/new_pages/reports.html)\n- [Epidemiologist R Handbook - Epidemic Curves](https://www.epirhandbook.com/en/new_pages/epidemic-curves.html)\n\n### Package Documentation\n- [ggplot2 Documentation](https://ggplot2.tidyverse.org/)\n- [DT (DataTables) Package](https://rstudio.github.io/DT/)\n\n:::\n",
    "supporting": [
      "task2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}