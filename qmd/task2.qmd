---
title: "Task 1: Generating a basic situation report"
---

## Overview

This task covers generating a basic situation report with dynamic figures and tables. You will learn how to create reproducible reports that can be easily updated as new data becomes available.

## Learning Objectives

- Create automated report generation workflows
- Incorporate dynamic figures and tables
- Use Quarto for report generation
- Build a basic epidemiological report with incidence curves and summary statistics

## Step-by-Step Instructions: Creating a Basic Epidemiological Report in Quarto

This tutorial will guide you through creating a basic epidemiological report using Quarto. You'll generate an HTML report with an incidence curve, case fatality ratio (CFR), and an interactive summary table.

**Note:** Before starting this task, make sure you have completed the setup steps on the [Setup](setup.qmd) page, including creating your project folder structure and a basic Quarto document.

### Step 1: Obtain the Cleaned Linelist Dataset

For this task, we will be using the **cleaned linelist file**. Download the cleaned linelist:

1. Navigate to the [Data](data.qmd) page on this website.
2. Click the download button for the **"clean" linelist (.rds)**.
3. **Save the file to your `data/` folder** that you created during setup.
4. The file path should be: `data/linelist_cleaned.rds` (relative to where your Quarto document is saved).

Alternatively, you can download it directly from: [linelist_cleaned.rds](https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds)

### Step 2: Load Required Packages

In your Quarto document, add or update the code chunk to load the packages needed for this task:

```{r}
#| echo: true
#| eval: true

# Load required packages
library(tidyverse)  # For data manipulation and visualization
library(reactable)  # For interactive tables
library(lubridate)   # For date handling
```

### Step 3: Import the Data

Create a new code chunk to import the cleaned linelist data. The cleaned file is in RDS format, which preserves column classes:

```{r}
#| echo: true
#| eval: false

# Import the cleaned linelist data from your local data folder
# Use the downloaded cleaned file
linelist <- readRDS("data/linelist_cleaned.rds")

# View the first few rows
head(linelist)
```

```{r}
#| echo: false
#| eval: true

# For rendering purposes, if file doesn't exist locally, read from URL
# This is only for website rendering - participants should have the file locally
linelist <- readRDS(url("https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds"))

# View the first few rows

reactable(head(linelist))
```

### Step 4: Create an Incidence Curve

Create a new section in your document and add a code chunk to create an incidence curve (epidemic curve) using `date_onset`:

```{r}
#| echo: true
#| eval: true
#| fig-cap: "Incidence Curve by Date of Onset"

# Create incidence curve
incidence_curve <- linelist |>
  ggplot(aes(x = date_onset)) +
  geom_histogram(binwidth = 7, fill = "steelblue", color = "white") +
  labs(
    title = "Incidence Curve by Date of Onset",
    x = "Date of Onset",
    y = "Number of Cases"
  ) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 14))

# Display the plot
print(incidence_curve)
```

### Step 5: Calculate Case Fatality Ratio (CFR)

Create a new section and calculate the CFR, making sure to exclude NA outcomes:

```{r}
#| echo: true
#| eval: true

# Calculate CFR (excluding NA outcomes)
cfr_data <- linelist |>
  filter(!is.na(outcome)) |>
  summarise(
    total_cases = n(),
    deaths = sum(outcome == "Death", na.rm = TRUE),
    recovered = sum(outcome == "Recover", na.rm = TRUE),
    cfr = round((deaths / total_cases) * 100, 2)
  )
```

The estimated Case Fatality Ratio is `r cfr_data$cfr`%.

### Step 6: Create an Interactive Summary Table by Hospital

Create a new section and generate an interactive summary table grouped by hospital using `reactable()`:

```{r}
#| echo: true
#| eval: true

# Create summary table by hospital
# Group NA and "Other" together
hospital_summary <- linelist |>
  mutate(
    hospital_grouped = case_when(
      is.na(hospital) | hospital %in% c("Missing", "Other") ~ "Other/Unknown",
      TRUE ~ hospital
    )
  ) |>
  group_by(hospital_grouped) |>
  summarise(
    total_cases = n(),
    deaths = sum(outcome == "Death", na.rm = TRUE),
    recovered = sum(outcome == "Recover", na.rm = TRUE),
    .groups = "drop"
  ) |>
  rename(hospital = hospital_grouped) |>
  mutate(
    cfr = round((deaths / (deaths + recovered)) * 100, 2),
    cfr = ifelse(is.na(cfr), 0, cfr)
  )

# Create interactive table
reactable(
  hospital_summary,
  columns = list(
    hospital = colDef(name = "Hospital"),
    total_cases = colDef(name = "Total Cases"),
    deaths = colDef(name = "Deaths"),
    recovered = colDef(name = "Recovered"),
    cfr = colDef(name = "CFR (%)", format = colFormat(digits = 2))
  ),
  defaultPageSize = nrow(hospital_summary)
)
```

## Additional Resources

::: {.panel-tabset}

### Quarto Documentation
- [Quarto Documentation](https://quarto.org/)
- [Quarto for R](https://quarto.org/docs/get-started/hello/rstudio.html)

### R Handbook
- [Epidemiologist R Handbook - Reports](https://www.epirhandbook.com/en/new_pages/reports.html)
- [Epidemiologist R Handbook - Epidemic Curves](https://www.epirhandbook.com/en/new_pages/epidemic-curves.html)

### Package Documentation
- [ggplot2 Documentation](https://ggplot2.tidyverse.org/)
- [reactable Package](https://glin.github.io/reactable/)

:::
